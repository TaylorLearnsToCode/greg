{"ast":null,"code":"import { areEqual, cloneObject, doesExist } from '@shared/utilities/common-util/common.util';\nimport { TreasureList } from '@treasure/enter-treasure/model/treasure-list.model';\nimport { BehaviorSubject, Subject } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@shared/services/export/export.service\";\nexport class EnterTreasureControllerService {\n  constructor(exportService) {\n    this.exportService = exportService;\n    this.treasureListSource = new BehaviorSubject(new TreasureList());\n    this.editEntrySource = new Subject();\n    this.treasureList$ = this.treasureListSource.asObservable();\n    this.editEntry$ = this.editEntrySource.asObservable();\n  }\n  get treasureList() {\n    return cloneObject(this.treasureListSource.value);\n  }\n  get diceToRoll() {\n    return this.treasureList.diceToRoll;\n  }\n  set diceToRoll(newDice) {\n    const nextList = this.treasureList;\n    nextList.diceToRoll = newDice;\n    this.treasureListSource.next(nextList);\n  }\n  get entries() {\n    return this.treasureList.entries;\n  }\n  set entries(newList) {\n    const nextList = this.treasureList;\n    nextList.entries = newList;\n    this.treasureListSource.next(nextList);\n  }\n  addEntry(newEntry) {\n    if (doesExist(newEntry)) {\n      const nextEntries = this.entries;\n      const indexOf = nextEntries.findIndex(entry => areEqual(entry.type, newEntry.type));\n      if (indexOf === -1) {\n        nextEntries.push(newEntry);\n      } else {\n        nextEntries.splice(indexOf, 1, newEntry);\n      }\n      this.entries = nextEntries;\n    }\n  }\n  clearList() {\n    this.treasureListSource.next(new TreasureList());\n  }\n  compareDiceToRoll(newDice) {\n    return areEqual(newDice, this.diceToRoll);\n  }\n  containsEntry(newEntries) {\n    return !!this.entries.filter(entry => areEqual(entry, newEntries)).length;\n  }\n  editEntryAt(index) {\n    this.editEntrySource.next(this.treasureList.entries[index]);\n  }\n  exportList() {\n    this.exportService.exportAsJson(this.treasureList, 'treasure-list');\n  }\n  importMapOrMagic(file) {\n    const fileReader = new FileReader();\n    fileReader.addEventListener('load', () => {\n      const result = fileReader.result;\n      const item = JSON.parse(result);\n    });\n    fileReader.readAsText(file);\n  }\n  importSavedList(file) {\n    const fileReader = new FileReader();\n    fileReader.addEventListener('load', () => {\n      const result = fileReader.result;\n      const newList = JSON.parse(result);\n      this.treasureListSource.next(newList);\n    });\n    fileReader.readAsText(file);\n  }\n  updateDiceToRoll(newDice) {\n    if (doesExist(newDice)) {\n      this.diceToRoll = newDice;\n    }\n  }\n}\nEnterTreasureControllerService.ɵfac = function EnterTreasureControllerService_Factory(t) {\n  return new (t || EnterTreasureControllerService)(i0.ɵɵinject(i1.ExportService));\n};\nEnterTreasureControllerService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: EnterTreasureControllerService,\n  factory: EnterTreasureControllerService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":"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","names":["areEqual","cloneObject","doesExist","TreasureList","BehaviorSubject","Subject","EnterTreasureControllerService","constructor","exportService","treasureListSource","asObservable","editEntrySource","treasureList","value","diceToRoll","newDice","nextList","next","entries","newList","addEntry","newEntry","nextEntries","indexOf","findIndex","entry","type","push","splice","clearList","compareDiceToRoll","containsEntry","newEntries","filter","length","editEntryAt","index","exportList","exportAsJson","importMapOrMagic","file","fileReader","FileReader","addEventListener","result","item","JSON","parse","readAsText","importSavedList","updateDiceToRoll","factory","providedIn"],"sourceRoot":"","sources":["D:\\workspaces\\greg\\src\\app\\treasure\\enter-treasure\\services\\enter-treasure-controller\\enter-treasure-controller.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { DiceRolled } from '@shared/model/dice-rolled.model';\nimport { ExportService } from '@shared/services/export/export.service';\nimport {\n  areEqual,\n  cloneObject,\n  doesExist,\n} from '@shared/utilities/common-util/common.util';\nimport { TreasureListEntry } from '@treasure/enter-treasure/model/treasure-list-entry.model';\nimport { TreasureList } from '@treasure/enter-treasure/model/treasure-list.model';\nimport { NestedMagicItemTable } from '@treasure/treasure-common/model/magic-item.model';\nimport { BehaviorSubject, Subject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class EnterTreasureControllerService {\n  private treasureListSource: BehaviorSubject<TreasureList> =\n    new BehaviorSubject(new TreasureList());\n  private get treasureList(): TreasureList {\n    return cloneObject(this.treasureListSource.value);\n  }\n\n  private editEntrySource: Subject<TreasureListEntry> = new Subject();\n\n  private get diceToRoll(): DiceRolled {\n    return this.treasureList.diceToRoll;\n  }\n  private set diceToRoll(newDice: DiceRolled) {\n    const nextList = this.treasureList;\n    nextList.diceToRoll = newDice;\n    this.treasureListSource.next(nextList);\n  }\n  private get entries(): TreasureListEntry[] {\n    return this.treasureList.entries;\n  }\n  private set entries(newList: TreasureListEntry[]) {\n    const nextList = this.treasureList;\n    nextList.entries = newList;\n    this.treasureListSource.next(nextList);\n  }\n\n  treasureList$ = this.treasureListSource.asObservable();\n  editEntry$ = this.editEntrySource.asObservable();\n\n  constructor(private exportService: ExportService) {}\n\n  addEntry(newEntry: TreasureListEntry): void {\n    if (doesExist(newEntry)) {\n      const nextEntries = this.entries;\n      const indexOf: number = nextEntries.findIndex((entry) =>\n        areEqual(entry.type, newEntry.type)\n      );\n      if (indexOf === -1) {\n        nextEntries.push(newEntry);\n      } else {\n        nextEntries.splice(indexOf, 1, newEntry);\n      }\n\n      this.entries = nextEntries;\n    }\n  }\n\n  clearList(): void {\n    this.treasureListSource.next(new TreasureList());\n  }\n\n  compareDiceToRoll(newDice: DiceRolled): boolean {\n    return areEqual(newDice, this.diceToRoll);\n  }\n\n  containsEntry(newEntries: TreasureListEntry): boolean {\n    return !!this.entries.filter((entry) => areEqual(entry, newEntries)).length;\n  }\n\n  editEntryAt(index: number): void {\n    this.editEntrySource.next(this.treasureList.entries[index]);\n  }\n\n  exportList(): void {\n    this.exportService.exportAsJson(this.treasureList, 'treasure-list');\n  }\n\n  importMapOrMagic(file: File): void {\n    const fileReader: FileReader = new FileReader();\n    fileReader.addEventListener('load', () => {\n      const result: string = fileReader.result as string;\n      const item: NestedMagicItemTable = JSON.parse(\n        result\n      ) as NestedMagicItemTable;\n    });\n    fileReader.readAsText(file);\n  }\n\n  importSavedList(file: File): void {\n    const fileReader: FileReader = new FileReader();\n    fileReader.addEventListener('load', () => {\n      const result: string = fileReader.result as string;\n      const newList: TreasureList = JSON.parse(result);\n      this.treasureListSource.next(newList);\n    });\n    fileReader.readAsText(file);\n  }\n\n  updateDiceToRoll(newDice: DiceRolled): void {\n    if (doesExist(newDice)) {\n      this.diceToRoll = newDice;\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}