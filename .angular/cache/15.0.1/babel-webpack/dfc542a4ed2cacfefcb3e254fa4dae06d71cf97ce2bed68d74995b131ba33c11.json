{"ast":null,"code":"import { ElementRef } from '@angular/core';\nimport { cloneObject, doesExist } from '@shared/utilities/common-util/common.util';\nimport { buildFormFromObject } from '@shared/utilities/form-util/form.util';\nimport { MagicItemMap, MagicItemMapEntry, TreasureMap } from '@treasure/treasure-common/model/treasure-map.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@treasure/enter-map-or-magic/services/map-or-magic-controller-service/map-or-magic-controller-service.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../../../../shared/components/dice-roller-form/dice-roller-form.component\";\nimport * as i4 from \"@angular/forms\";\nconst _c0 = [\"magicItemImport\"];\nfunction MapEntryFormComponent_ng_container_30_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"span\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const entry_r1 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", entry_r1.value.item.entry.name, \" \");\n  }\n}\nfunction MapEntryFormComponent_ng_container_30_ng_template_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"span\")(1, \"label\");\n    i0.ɵɵtext(2, \"Import Item \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"input\", 11, 12);\n    i0.ɵɵlistener(\"change\", function MapEntryFormComponent_ng_container_30_ng_template_6_Template_input_change_3_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const i_r2 = i0.ɵɵnextContext().index;\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.importMagicItemList(i_r2));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"a\", 3);\n    i0.ɵɵlistener(\"click\", function MapEntryFormComponent_ng_container_30_ng_template_6_Template_a_click_5_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const i_r2 = i0.ɵɵnextContext().index;\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.removeEntryAt(i_r2));\n    });\n    i0.ɵɵtext(6, \"X\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction MapEntryFormComponent_ng_container_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0)(1, 7);\n    i0.ɵɵelementStart(2, \"label\");\n    i0.ɵɵtext(3, \"Number Of\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(4, \"input\", 8);\n    i0.ɵɵtemplate(5, MapEntryFormComponent_ng_container_30_ng_container_5_Template, 3, 1, \"ng-container\", 9);\n    i0.ɵɵtemplate(6, MapEntryFormComponent_ng_container_30_ng_template_6_Template, 7, 0, \"ng-template\", null, 10, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementContainerEnd()();\n  }\n  if (rf & 2) {\n    const entry_r1 = ctx.$implicit;\n    const i_r2 = ctx.index;\n    const _r4 = i0.ɵɵreference(7);\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroupName\", i_r2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isEntryPresent(entry_r1.value))(\"ngIfElse\", _r4);\n  }\n}\nexport class MapEntryFormComponent {\n  constructor(controllerService) {\n    this.controllerService = controllerService;\n  }\n  get magicItemImport() {\n    return this.magicItemImportInputRef.nativeElement;\n  }\n  get magicTreasureFormArray() {\n    return this.magicMapForm.get('treasure');\n  }\n  ngOnInit() {\n    this.initializeTreasureMap();\n    this.initializeMagicMap();\n  }\n  addMagicTreasure() {\n    const nextMagicForm = cloneObject(this.magicMapForm.value);\n    nextMagicForm.treasure.push(new MagicItemMapEntry());\n    this.magicMapForm = buildFormFromObject(nextMagicForm);\n  }\n  importMagicItemList(index) {\n    const fileReader = new FileReader();\n    fileReader.addEventListener('load', () => {\n      const result = fileReader.result;\n      const list = JSON.parse(result);\n      const nextMagicForm = cloneObject(this.magicMapForm.value);\n      nextMagicForm.treasure[index].item.entry = list;\n      this.magicMapForm = buildFormFromObject(nextMagicForm);\n      this.magicItemImport.value = '';\n    });\n    fileReader.readAsText(this.magicItemImport.files[0]);\n  }\n  isEntryPresent(entry) {\n    if (doesExist(entry) && doesExist(entry.item) && doesExist(entry.item.entry)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n  removeEntryAt(index) {\n    const nextMagicForm = cloneObject(this.magicMapForm.value);\n    nextMagicForm.treasure.splice(index, 1);\n    this.magicMapForm = buildFormFromObject(nextMagicForm);\n  }\n  saveMagicMap() {\n    this.controllerService.addTreasureMap(this.magicMapForm.value);\n    this.initializeMagicMap();\n  }\n  saveTreasureMap() {\n    this.controllerService.addTreasureMap(this.treasureMapForm.value);\n    this.initializeTreasureMap();\n  }\n  initializeMagicMap() {\n    this.magicMapForm = buildFormFromObject(new MagicItemMap());\n  }\n  initializeTreasureMap() {\n    this.treasureMapForm = buildFormFromObject(new TreasureMap());\n  }\n}\nMapEntryFormComponent.ɵfac = function MapEntryFormComponent_Factory(t) {\n  return new (t || MapEntryFormComponent)(i0.ɵɵdirectiveInject(i1.MapOrMagicControllerServiceService));\n};\nMapEntryFormComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: MapEntryFormComponent,\n  selectors: [[\"greg-map-entry-form\"]],\n  viewQuery: function MapEntryFormComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.magicItemImportInputRef = _t.first);\n    }\n  },\n  decls: 37,\n  vars: 7,\n  consts: [[1, \"treasure-map-form\", 3, \"formGroup\"], [\"formControlName\", \"name\", \"type\", \"text\"], [3, \"parentForm\"], [3, \"click\"], [1, \"magic-item-form\", 3, \"formGroup\"], [\"formArrayName\", \"treasure\"], [4, \"ngFor\", \"ngForOf\"], [3, \"formGroupName\"], [\"formControlName\", \"numberOf\", \"type\", \"number\"], [4, \"ngIf\", \"ngIfElse\"], [\"importItem\", \"\"], [\"type\", \"file\", 3, \"change\"], [\"magicItemImport\", \"\"]],\n  template: function MapEntryFormComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"h3\");\n      i0.ɵɵtext(1, \"Treasure Map\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(2, \"form\", 0)(3, \"label\");\n      i0.ɵɵtext(4, \"Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(5, \"input\", 1);\n      i0.ɵɵelementStart(6, \"label\");\n      i0.ɵɵtext(7, \"Silver\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(8, \"greg-dice-roller-form\", 2);\n      i0.ɵɵelementStart(9, \"label\");\n      i0.ɵɵtext(10, \"Gold\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(11, \"greg-dice-roller-form\", 2);\n      i0.ɵɵelementStart(12, \"label\");\n      i0.ɵɵtext(13, \"Gems\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(14, \"greg-dice-roller-form\", 2);\n      i0.ɵɵelementStart(15, \"label\");\n      i0.ɵɵtext(16, \"Jewelry\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(17, \"greg-dice-roller-form\", 2);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(18, \"section\")(19, \"button\", 3);\n      i0.ɵɵlistener(\"click\", function MapEntryFormComponent_Template_button_click_19_listener() {\n        return ctx.saveTreasureMap();\n      });\n      i0.ɵɵtext(20, \"Save Treasure Map Entry\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(21, \"h3\");\n      i0.ɵɵtext(22, \"Magic Item Map\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(23, \"form\", 4)(24, \"label\");\n      i0.ɵɵtext(25, \"Name\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(26, \"span\");\n      i0.ɵɵtext(27, \"\\u00A0\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(28, \"input\", 1);\n      i0.ɵɵelementContainerStart(29, 5);\n      i0.ɵɵtemplate(30, MapEntryFormComponent_ng_container_30_Template, 8, 3, \"ng-container\", 6);\n      i0.ɵɵelementContainerEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(31, \"section\")(32, \"button\", 3);\n      i0.ɵɵlistener(\"click\", function MapEntryFormComponent_Template_button_click_32_listener() {\n        return ctx.addMagicTreasure();\n      });\n      i0.ɵɵtext(33, \"Add Magic Treasure Entry\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(34, \"br\");\n      i0.ɵɵelementStart(35, \"button\", 3);\n      i0.ɵɵlistener(\"click\", function MapEntryFormComponent_Template_button_click_35_listener() {\n        return ctx.saveMagicMap();\n      });\n      i0.ɵɵtext(36, \"Save Magic Treasure Map Entry\");\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"formGroup\", ctx.treasureMapForm);\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"parentForm\", ctx.treasureMapForm.get(\"silver\"));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"parentForm\", ctx.treasureMapForm.get(\"gold\"));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"parentForm\", ctx.treasureMapForm.get(\"gems\"));\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"parentForm\", ctx.treasureMapForm.get(\"jewelry\"));\n      i0.ɵɵadvance(6);\n      i0.ɵɵproperty(\"formGroup\", ctx.magicMapForm);\n      i0.ɵɵadvance(7);\n      i0.ɵɵproperty(\"ngForOf\", ctx.magicTreasureFormArray.controls);\n    }\n  },\n  dependencies: [i2.NgForOf, i2.NgIf, i3.DiceRollerFormComponent, i4.ɵNgNoValidate, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.FormControlName, i4.FormGroupName, i4.FormArrayName],\n  styles: [\"form.magic-item-form[_ngcontent-%COMP%] {\\n  display: grid;\\n  grid-template-columns: 1fr 1fr 2fr;\\n}\\n\\nform.treasure-map-form[_ngcontent-%COMP%] {\\n  display: grid;\\n  grid-template-columns: repeat(2, 1fr);\\n}\\n\\nh3[_ngcontent-%COMP%] {\\n  padding-left: 2em;\\n}\\n\\nsection[_ngcontent-%COMP%], span[_ngcontent-%COMP%] {\\n  text-align: center;\\n}\\n/*# sourceURL=webpack://./src/app/treasure/enter-map-or-magic/components/map-entry-form/map-entry-form.component.scss */\\n/*# sourceURL=webpack://./src/assets/styles/_variables.scss */\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvdHJlYXN1cmUvZW50ZXItbWFwLW9yLW1hZ2ljL2NvbXBvbmVudHMvbWFwLWVudHJ5LWZvcm0vbWFwLWVudHJ5LWZvcm0uY29tcG9uZW50LnNjc3MiLCJ3ZWJwYWNrOi8vLi9zcmMvYXNzZXRzL3N0eWxlcy9fdmFyaWFibGVzLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7RUFDRSxhQUFBO0VBQ0Esa0NBQUE7QUFERjs7QUFJQTtFQzZCRSxhQUFBO0VBQ0EscUNBQUE7QUQ3QkY7O0FBR0E7RUNGRSxpQkFBQTtBREdGOztBQUdBO0VBQ0Usa0JBQUE7QUFBRiIsInNvdXJjZXNDb250ZW50IjpbImZvcm0ubWFnaWMtaXRlbS1mb3JtIHtcbiAgZGlzcGxheTogZ3JpZDtcbiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgMWZyIDJmcjtcbn1cblxuZm9ybS50cmVhc3VyZS1tYXAtZm9ybSB7XG4gIGRpc3BsYXk6IGdyaWQ7XG4gIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDIsIDFmcik7XG59XG5cbmgzIHtcbiAgcGFkZGluZy1sZWZ0OiAyZW07XG59XG5cbnNlY3Rpb24sIHNwYW4ge1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG59IixudWxsXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"mappings":"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","names":["ElementRef","cloneObject","doesExist","buildFormFromObject","MagicItemMap","MagicItemMapEntry","TreasureMap","i0","MapEntryFormComponent","constructor","controllerService","magicItemImport","magicItemImportInputRef","nativeElement","magicTreasureFormArray","magicMapForm","get","ngOnInit","initializeTreasureMap","initializeMagicMap","addMagicTreasure","nextMagicForm","value","treasure","push","importMagicItemList","index","fileReader","FileReader","addEventListener","result","list","JSON","parse","item","entry","readAsText","files","isEntryPresent","removeEntryAt","splice","saveMagicMap","addTreasureMap","saveTreasureMap","treasureMapForm","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["D:\\workspaces\\greg\\src\\app\\treasure\\enter-map-or-magic\\components\\map-entry-form\\map-entry-form.component.ts","D:\\workspaces\\greg\\src\\app\\treasure\\enter-map-or-magic\\components\\map-entry-form\\map-entry-form.component.html"],"sourcesContent":["import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';\nimport {\n  FormArray,\n  FormControl,\n  FormGroup,\n  UntypedFormGroup,\n} from '@angular/forms';\nimport {\n  cloneObject,\n  doesExist,\n} from '@shared/utilities/common-util/common.util';\nimport { buildFormFromObject } from '@shared/utilities/form-util/form.util';\nimport { MapOrMagicControllerServiceService } from '@treasure/enter-map-or-magic/services/map-or-magic-controller-service/map-or-magic-controller-service.service';\nimport {\n  MagicItemTable,\n  NestedMagicItemTable,\n} from '@treasure/treasure-common/model/magic-item.model';\nimport {\n  MagicItemMap,\n  MagicItemMapEntry,\n  TreasureMap,\n} from '@treasure/treasure-common/model/treasure-map.model';\n\n@Component({\n  selector: 'greg-map-entry-form',\n  templateUrl: './map-entry-form.component.html',\n  styleUrls: ['./map-entry-form.component.scss'],\n})\nexport class MapEntryFormComponent implements OnInit {\n  @ViewChild('magicItemImport')\n  magicItemImportInputRef: ElementRef;\n  private get magicItemImport(): HTMLInputElement {\n    return this.magicItemImportInputRef.nativeElement as HTMLInputElement;\n  }\n\n  magicMapForm: UntypedFormGroup;\n  get magicTreasureFormArray(): FormArray<FormControl<MagicItemMapEntry>> {\n    return this.magicMapForm.get('treasure') as FormArray<\n      FormControl<MagicItemMapEntry>\n    >;\n  }\n  treasureMapForm: UntypedFormGroup;\n\n  constructor(private controllerService: MapOrMagicControllerServiceService) {}\n\n  ngOnInit(): void {\n    this.initializeTreasureMap();\n    this.initializeMagicMap();\n  }\n\n  addMagicTreasure(): void {\n    const nextMagicForm: MagicItemMap = cloneObject(this.magicMapForm.value);\n    nextMagicForm.treasure.push(new MagicItemMapEntry());\n    this.magicMapForm = buildFormFromObject(nextMagicForm) as FormGroup;\n  }\n\n  importMagicItemList(index: number): void {\n    const fileReader: FileReader = new FileReader();\n    fileReader.addEventListener('load', () => {\n      const result: string = fileReader.result as string;\n      const list: MagicItemTable | NestedMagicItemTable = JSON.parse(\n        result\n      ) as any;\n      const nextMagicForm: MagicItemMap = cloneObject(this.magicMapForm.value);\n      nextMagicForm.treasure[index].item.entry = list;\n      this.magicMapForm = buildFormFromObject(nextMagicForm) as FormGroup;\n      this.magicItemImport.value = '';\n    });\n    fileReader.readAsText(this.magicItemImport.files[0]);\n  }\n\n  isEntryPresent(entry: MagicItemMapEntry): boolean {\n    if (\n      doesExist(entry) &&\n      doesExist(entry.item) &&\n      doesExist(entry.item.entry)\n    ) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  removeEntryAt(index: number): void {\n    const nextMagicForm: MagicItemMap = cloneObject(this.magicMapForm.value);\n    nextMagicForm.treasure.splice(index, 1);\n    this.magicMapForm = buildFormFromObject(nextMagicForm) as FormGroup;\n  }\n\n  saveMagicMap(): void {\n    this.controllerService.addTreasureMap(this.magicMapForm.value);\n    this.initializeMagicMap();\n  }\n\n  saveTreasureMap(): void {\n    this.controllerService.addTreasureMap(this.treasureMapForm.value);\n    this.initializeTreasureMap();\n  }\n\n  private initializeMagicMap(): void {\n    this.magicMapForm = buildFormFromObject(new MagicItemMap()) as FormGroup;\n  }\n\n  private initializeTreasureMap(): void {\n    this.treasureMapForm = buildFormFromObject(new TreasureMap()) as FormGroup;\n  }\n}\n","<h3>Treasure Map</h3>\r\n<form [formGroup]=\"treasureMapForm\" class=\"treasure-map-form\">\r\n  <label>Name</label>\r\n  <input formControlName=\"name\" type=\"text\" />\r\n\r\n  <label>Silver</label>\r\n  <greg-dice-roller-form\r\n    [parentForm]=\"treasureMapForm.get('silver')\"\r\n  ></greg-dice-roller-form>\r\n\r\n  <label>Gold</label>\r\n  <greg-dice-roller-form\r\n    [parentForm]=\"treasureMapForm.get('gold')\"\r\n  ></greg-dice-roller-form>\r\n\r\n  <label>Gems</label>\r\n  <greg-dice-roller-form\r\n    [parentForm]=\"treasureMapForm.get('gems')\"\r\n  ></greg-dice-roller-form>\r\n\r\n  <label>Jewelry</label>\r\n  <greg-dice-roller-form\r\n    [parentForm]=\"treasureMapForm.get('jewelry')\"\r\n  ></greg-dice-roller-form>\r\n</form>\r\n<section>\r\n  <button (click)=\"saveTreasureMap()\">Save Treasure Map Entry</button>\r\n</section>\r\n\r\n<h3>Magic Item Map</h3>\r\n<form [formGroup]=\"magicMapForm\" class=\"magic-item-form\">\r\n  <label>Name</label>\r\n  <span>&nbsp;</span>\r\n  <input formControlName=\"name\" type=\"text\" />\r\n\r\n  <ng-container formArrayName=\"treasure\">\r\n    <ng-container\r\n      *ngFor=\"let entry of magicTreasureFormArray.controls; index as i\"\r\n    >\r\n      <ng-container [formGroupName]=\"i\">\r\n        <label>Number Of</label>\r\n        <input formControlName=\"numberOf\" type=\"number\" />\r\n\r\n        <ng-container *ngIf=\"isEntryPresent(entry.value); else importItem\">\r\n          <span>\r\n            {{ entry.value.item.entry.name }}\r\n          </span>\r\n        </ng-container>\r\n        <ng-template #importItem>\r\n          <span>\r\n            <label>Import Item </label>\r\n            <input\r\n              #magicItemImport\r\n              (change)=\"importMagicItemList(i)\"\r\n              type=\"file\"\r\n            />\r\n            <a (click)=\"removeEntryAt(i)\">X</a>\r\n          </span>\r\n        </ng-template>\r\n      </ng-container>\r\n    </ng-container>\r\n  </ng-container>\r\n</form>\r\n<section>\r\n  <button (click)=\"addMagicTreasure()\">Add Magic Treasure Entry</button>\r\n  <br />\r\n  <button (click)=\"saveMagicMap()\">Save Magic Treasure Map Entry</button>\r\n</section>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}