{"ast":null,"code":"import { ElementRef } from '@angular/core';\nimport { buildFormFromObject } from '@shared/utilities/form-util/form.util';\nimport { NestedMagicItemTable } from '@treasure/treasure-common/model/magic-item.model';\nimport { Subject } from 'rxjs';\nimport { takeUntil, tap } from 'rxjs/operators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@treasure/create-nested-magic-item-table/services/nested-magic-item-table-controller/nested-magic-item-table-controller.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"../../../../shared/components/bounded-range-form/bounded-range-form.component\";\nimport * as i4 from \"@angular/forms\";\nconst _c0 = [\"uploadEntryInput\"];\nfunction EnterNestedMagicItemTableComponent_tr_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\");\n    i0.ɵɵelementContainerStart(1, 8);\n    i0.ɵɵelementStart(2, \"td\");\n    i0.ɵɵelement(3, \"greg-bounded-range-form\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"td\", 10);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const entry_r2 = ctx.$implicit;\n    const i_r3 = ctx.index;\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroupName\", i_r3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"parentForm\", entry_r2.get(\"chanceOf\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", entry_r2.get(\"entry\").value.name, \" \");\n  }\n}\nexport class EnterNestedMagicItemTableComponent {\n  constructor(controllerService) {\n    this.controllerService = controllerService;\n    this.destroySource = new Subject();\n  }\n  get entries() {\n    return this.nestedTableForm.get('entries');\n  }\n  set entries(formArray) {\n    this.nestedTableForm.setControl('entries', formArray);\n  }\n  get uploadEntryInput() {\n    return this.uploadEntryInputRef.nativeElement;\n  }\n  ngOnInit() {\n    this.initializeNestedTableForm();\n    this.controllerService.nestedTable$.pipe(tap(table => this.entries = buildFormFromObject(table.entries)), takeUntil(this.destroySource)).subscribe();\n  }\n  ngOnDestroy() {\n    this.destroySource.next();\n  }\n  importEntry() {\n    this.controllerService.importEntry(this.uploadEntryInput.files[0]);\n    this.uploadEntryInput.value = '';\n  }\n  initializeNestedTableForm() {\n    this.nestedTableForm = buildFormFromObject(new NestedMagicItemTable());\n    this.nestedTableForm.valueChanges.pipe(tap(table => {\n      if (!this.controllerService.compareTable(table)) {\n        this.controllerService.updateTable(table);\n      }\n    }), takeUntil(this.destroySource)).subscribe();\n  }\n}\nEnterNestedMagicItemTableComponent.ɵfac = function EnterNestedMagicItemTableComponent_Factory(t) {\n  return new (t || EnterNestedMagicItemTableComponent)(i0.ɵɵdirectiveInject(i1.NestedMagicItemTableControllerService));\n};\nEnterNestedMagicItemTableComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: EnterNestedMagicItemTableComponent,\n  selectors: [[\"greg-enter-nested-magic-item-table\"]],\n  viewQuery: function EnterNestedMagicItemTableComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5);\n    }\n    if (rf & 2) {\n      let _t;\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.uploadEntryInputRef = _t.first);\n    }\n  },\n  decls: 16,\n  vars: 2,\n  consts: [[3, \"formGroup\"], [\"formControlName\", \"name\", \"type\", \"text\"], [\"formArrayName\", \"entries\"], [1, \"range-header\"], [1, \"result-header\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"file\", 3, \"change\"], [\"uploadEntryInput\", \"\"], [3, \"formGroupName\"], [3, \"parentForm\"], [1, \"result-entry\"]],\n  template: function EnterNestedMagicItemTableComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"form\", 0)(1, \"label\");\n      i0.ɵɵtext(2, \"Table Name: \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(3, \"input\", 1);\n      i0.ɵɵelementStart(4, \"table\", 2)(5, \"tr\")(6, \"th\", 3);\n      i0.ɵɵtext(7, \"Range\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"th\", 4);\n      i0.ɵɵtext(9, \"Result\");\n      i0.ɵɵelementEnd()();\n      i0.ɵɵtemplate(10, EnterNestedMagicItemTableComponent_tr_10_Template, 6, 3, \"tr\", 5);\n      i0.ɵɵelementEnd()();\n      i0.ɵɵelementStart(11, \"section\")(12, \"label\");\n      i0.ɵɵtext(13, \"Upload Entry: \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(14, \"input\", 6, 7);\n      i0.ɵɵlistener(\"change\", function EnterNestedMagicItemTableComponent_Template_input_change_14_listener() {\n        return ctx.importEntry();\n      });\n      i0.ɵɵelementEnd()();\n    }\n    if (rf & 2) {\n      i0.ɵɵproperty(\"formGroup\", ctx.nestedTableForm);\n      i0.ɵɵadvance(10);\n      i0.ɵɵproperty(\"ngForOf\", ctx.entries.controls);\n    }\n  },\n  dependencies: [i2.NgForOf, i3.BoundedRangeFormComponent, i4.ɵNgNoValidate, i4.DefaultValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.FormGroupDirective, i4.FormControlName, i4.FormGroupName, i4.FormArrayName],\n  styles: [\"section[_ngcontent-%COMP%] {\\n  text-align: center;\\n}\\n\\ntd[_ngcontent-%COMP%] {\\n  text-align: center;\\n}\\n\\n.range-header[_ngcontent-%COMP%] {\\n  width: 6em;\\n}\\n\\n.result-entry[_ngcontent-%COMP%] {\\n  text-align: left;\\n  padding: 0em 1em;\\n}\\n\\n.result-header[_ngcontent-%COMP%] {\\n  text-align: left;\\n  padding-left: 3em;\\n}\\n/*# sourceURL=webpack://./src/app/treasure/create-nested-magic-item-table/components/enter-nested-magic-item-table/enter-nested-magic-item-table.component.scss */\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvdHJlYXN1cmUvY3JlYXRlLW5lc3RlZC1tYWdpYy1pdGVtLXRhYmxlL2NvbXBvbmVudHMvZW50ZXItbmVzdGVkLW1hZ2ljLWl0ZW0tdGFibGUvZW50ZXItbmVzdGVkLW1hZ2ljLWl0ZW0tdGFibGUuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxrQkFBQTtBQUNGOztBQUVFO0VBQ0Usa0JBQUE7QUFDSjs7QUFFRTtFQUNFLFVBQUE7QUFDSjs7QUFFRTtFQUNFLGdCQUFBO0VBQ0EsZ0JBQUE7QUFDSjs7QUFFRTtFQUNFLGdCQUFBO0VBQ0EsaUJBQUE7QUFDSiIsInNvdXJjZXNDb250ZW50IjpbInNlY3Rpb24ge1xuICB0ZXh0LWFsaWduOiBjZW50ZXI7XG59XG5cbnRkIHtcbiAgdGV4dC1hbGlnbjogY2VudGVyO1xufVxuXG4ucmFuZ2UtaGVhZGVyIHtcbiAgd2lkdGg6IDZlbTtcbn1cblxuLnJlc3VsdC1lbnRyeSB7XG4gIHRleHQtYWxpZ246IGxlZnQ7XG4gIHBhZGRpbmc6IDBlbSAxZW07XG59XG5cbi5yZXN1bHQtaGVhZGVyIHtcbiAgdGV4dC1hbGlnbjogbGVmdDtcbiAgcGFkZGluZy1sZWZ0OiAzZW07XG59Il0sInNvdXJjZVJvb3QiOiIifQ== */\"]\n});","map":{"version":3,"mappings":"AAAA,SAEEA,UAAU,QAIL,eAAe;AAEtB,SAASC,mBAAmB,QAAQ,uCAAuC;AAE3E,SAASC,oBAAoB,QAAQ,kDAAkD;AACvF,SAAqBC,OAAO,QAAQ,MAAM;AAC1C,SAASC,SAAS,EAAEC,GAAG,QAAQ,gBAAgB;;;;;;;;;ICJ3CC,0BAAuD;IACrDA,gCAAkC;IAChCA,0BAAI;IACFA,6CAE2B;IAC7BA,iBAAK;IACLA,8BAAyB;IACvBA,YACF;IAAAA,iBAAK;IACPA,0BAAe;IACjBA,iBAAK;;;;;IAVWA,eAAmB;IAAnBA,oCAAmB;IAG3BA,eAAoC;IAApCA,qDAAoC;IAItCA,eACF;IADEA,iEACF;;;ADER,OAAM,MAAOC,kCAAkC;EAoB7CC,YACUC,iBAAwD;IAAxD,sBAAiB,GAAjBA,iBAAiB;IAHnB,kBAAa,GAAkB,IAAIN,OAAO,EAAE;EAIjD;EAfH,IAAIO,OAAO;IACT,OAAO,IAAI,CAACC,eAAe,CAACC,GAAG,CAAC,SAAS,CAAc;EACzD;EACA,IAAIF,OAAO,CAACG,SAAoB;IAC9B,IAAI,CAACF,eAAe,CAACG,UAAU,CAAC,SAAS,EAAED,SAAS,CAAC;EACvD;EAEA,IAAIE,gBAAgB;IAClB,OAAO,IAAI,CAACC,mBAAmB,CAACC,aAAiC;EACnE;EAQAC,QAAQ;IACN,IAAI,CAACC,yBAAyB,EAAE;IAChC,IAAI,CAACV,iBAAiB,CAACW,YAAY,CAChCC,IAAI,CACHhB,GAAG,CACAiB,KAAK,IACH,IAAI,CAACZ,OAAO,GAAGT,mBAAmB,CAACqB,KAAK,CAACZ,OAAO,CAAe,CACnE,EACDN,SAAS,CAAC,IAAI,CAACmB,aAAa,CAAC,CAC9B,CACAC,SAAS,EAAE;EAChB;EAEAC,WAAW;IACT,IAAI,CAACF,aAAa,CAACG,IAAI,EAAE;EAC3B;EAEAC,WAAW;IACT,IAAI,CAAClB,iBAAiB,CAACkB,WAAW,CAAC,IAAI,CAACZ,gBAAgB,CAACa,KAAK,CAAC,CAAC,CAAC,CAAC;IAClE,IAAI,CAACb,gBAAgB,CAACc,KAAK,GAAG,EAAE;EAClC;EAEQV,yBAAyB;IAC/B,IAAI,CAACR,eAAe,GAAGV,mBAAmB,CACxC,IAAIC,oBAAoB,EAAE,CACd;IACd,IAAI,CAACS,eAAe,CAACmB,YAAY,CAC9BT,IAAI,CACHhB,GAAG,CAAEiB,KAAK,IAAI;MACZ,IAAI,CAAC,IAAI,CAACb,iBAAiB,CAACsB,YAAY,CAACT,KAAK,CAAC,EAAE;QAC/C,IAAI,CAACb,iBAAiB,CAACuB,WAAW,CAACV,KAAK,CAAC;;IAE7C,CAAC,CAAC,EACFlB,SAAS,CAAC,IAAI,CAACmB,aAAa,CAAC,CAC9B,CACAC,SAAS,EAAE;EAChB;;;mBA5DWjB,kCAAkC;AAAA;;QAAlCA,kCAAkC;EAAA0B;EAAAC;IAAA;;;;;;;;;;;;;MCnB/C5B,+BAAoC;MAC3BA,4BAAY;MAAAA,iBAAQ;MAC3BA,2BAA4C;MAC5CA,gCAA+B;MAEFA,qBAAK;MAAAA,iBAAK;MACnCA,6BAA0B;MAAAA,sBAAM;MAAAA,iBAAK;MAEvCA,mFAWK;MACPA,iBAAQ;MAEVA,gCAAS;MACAA,+BAAc;MAAAA,iBAAQ;MAC7BA,oCAAgE;MAAvCA;QAAA,OAAU6B,iBAAa;MAAA,EAAC;MAAjD7B,iBAAgE;;;MAxB5DA,+CAA6B;MAQTA,gBAAqB;MAArBA,8CAAqB","names":["ElementRef","buildFormFromObject","NestedMagicItemTable","Subject","takeUntil","tap","i0","EnterNestedMagicItemTableComponent","constructor","controllerService","entries","nestedTableForm","get","formArray","setControl","uploadEntryInput","uploadEntryInputRef","nativeElement","ngOnInit","initializeNestedTableForm","nestedTable$","pipe","table","destroySource","subscribe","ngOnDestroy","next","importEntry","files","value","valueChanges","compareTable","updateTable","selectors","viewQuery","ctx"],"sourceRoot":"","sources":["D:\\workspaces\\greg\\src\\app\\treasure\\create-nested-magic-item-table\\components\\enter-nested-magic-item-table\\enter-nested-magic-item-table.component.ts","D:\\workspaces\\greg\\src\\app\\treasure\\create-nested-magic-item-table\\components\\enter-nested-magic-item-table\\enter-nested-magic-item-table.component.html"],"sourcesContent":["import {\r\n  Component,\r\n  ElementRef,\r\n  OnDestroy,\r\n  OnInit,\r\n  ViewChild,\r\n} from '@angular/core';\r\nimport { FormArray, FormGroup } from '@angular/forms';\r\nimport { buildFormFromObject } from '@shared/utilities/form-util/form.util';\r\nimport { NestedMagicItemTableControllerService } from '@treasure/create-nested-magic-item-table/services/nested-magic-item-table-controller/nested-magic-item-table-controller.service';\r\nimport { NestedMagicItemTable } from '@treasure/treasure-common/model/magic-item.model';\r\nimport { Observable, Subject } from 'rxjs';\r\nimport { takeUntil, tap } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'greg-enter-nested-magic-item-table',\r\n  templateUrl: './enter-nested-magic-item-table.component.html',\r\n  styleUrls: ['./enter-nested-magic-item-table.component.scss'],\r\n})\r\nexport class EnterNestedMagicItemTableComponent implements OnInit, OnDestroy {\r\n  @ViewChild('uploadEntryInput')\r\n  uploadEntryInputRef: ElementRef;\r\n\r\n  nestedTable$: Observable<NestedMagicItemTable>;\r\n  nestedTableForm: FormGroup;\r\n\r\n  get entries(): FormArray {\r\n    return this.nestedTableForm.get('entries') as FormArray;\r\n  }\r\n  set entries(formArray: FormArray) {\r\n    this.nestedTableForm.setControl('entries', formArray);\r\n  }\r\n\r\n  get uploadEntryInput(): HTMLInputElement {\r\n    return this.uploadEntryInputRef.nativeElement as HTMLInputElement;\r\n  }\r\n\r\n  private destroySource: Subject<void> = new Subject();\r\n\r\n  constructor(\r\n    private controllerService: NestedMagicItemTableControllerService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.initializeNestedTableForm();\r\n    this.controllerService.nestedTable$\r\n      .pipe(\r\n        tap(\r\n          (table) =>\r\n            (this.entries = buildFormFromObject(table.entries) as FormArray)\r\n        ),\r\n        takeUntil(this.destroySource)\r\n      )\r\n      .subscribe();\r\n  }\r\n\r\n  ngOnDestroy(): void {\r\n    this.destroySource.next();\r\n  }\r\n\r\n  importEntry(): void {\r\n    this.controllerService.importEntry(this.uploadEntryInput.files[0]);\r\n    this.uploadEntryInput.value = '';\r\n  }\r\n\r\n  private initializeNestedTableForm(): void {\r\n    this.nestedTableForm = buildFormFromObject(\r\n      new NestedMagicItemTable()\r\n    ) as FormGroup;\r\n    this.nestedTableForm.valueChanges\r\n      .pipe(\r\n        tap((table) => {\r\n          if (!this.controllerService.compareTable(table)) {\r\n            this.controllerService.updateTable(table);\r\n          }\r\n        }),\r\n        takeUntil(this.destroySource)\r\n      )\r\n      .subscribe();\r\n  }\r\n}\r\n","<form [formGroup]=\"nestedTableForm\">\r\n  <label>Table Name: </label>\r\n  <input formControlName=\"name\" type=\"text\" />\r\n  <table formArrayName=\"entries\">\r\n    <tr>\r\n      <th class=\"range-header\">Range</th>\r\n      <th class=\"result-header\">Result</th>\r\n    </tr>\r\n    <tr *ngFor=\"let entry of entries.controls; index as i\">\r\n      <ng-container [formGroupName]=\"i\">\r\n        <td>\r\n          <greg-bounded-range-form\r\n            [parentForm]=\"entry.get('chanceOf')\"\r\n          ></greg-bounded-range-form>\r\n        </td>\r\n        <td class=\"result-entry\">\r\n          {{ entry.get(\"entry\").value.name }}\r\n        </td>\r\n      </ng-container>\r\n    </tr>\r\n  </table>\r\n</form>\r\n<section>\r\n  <label>Upload Entry: </label>\r\n  <input #uploadEntryInput (change)=\"importEntry()\" type=\"file\" />\r\n</section>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}